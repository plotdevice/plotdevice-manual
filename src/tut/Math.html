<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html><head>

  <title></title>

</head><body>
  <div class="article">
    <p>More often than not, your PlotDevice scripts will involve at least a bit of mathematics.
    Things like fluid motion, orbitting behavior and easing in and out all require math formulas.
    Since most of us probably weren’t paying any attention during math class, this document
    explains some useful math techniques.<a id="Geometry" name="Geometry"></a></p>
    <div class="section">
      <h3>Geometry</h3>

      <p>Sometimes you have the location of two points and you want to know the angle between them.
      Or the distance. Or you have the coordinates of one point and want to know the location of
      the second point based on an angle and a distance. The following math commands might be of
      help. You can also find the basics about sines and cosines <a href="#Trigonometry">below</a>.<br/></p>
      <p>The angle between two points:</p>
<pre>def angle(x0, y0, x1, y1):
    from math import degrees, atan2
    a = degrees( atan2(y1-y0, x1-x0) )
    return a
</pre>

      <p>The distance between two points:</p>
<pre>def distance(x0, y0, x1, y1):
    from math import sqrt, pow
    return sqrt(pow(x1-x0, 2) + pow(y1-y0, 2))
</pre>

      <p>The location of a point based on angle and distance:</p>
<pre>def coordinates(x0, y0, distance, angle):
    from math import radians, sin, cos
    x1 = x0 + cos(radians(angle)) * distance
    y1 = y0 + sin(radians(angle)) * distance
    return x1, y1
</pre>

      <p>The reflection of a point through an origin point:</p>
<pre>def reflect(x0, y0, x1, y1, d=1.0, a=180):
    d *= distance(x0, y0, x1, y1)
    a += angle(x0, y0, x1, y1)
    x, y = coordinates(x0, y0, d, a)
    return x, y
</pre>

      <p>To use fast, C-based versions of these commands in your script, you can import them from the <code>plotdevice</code> module:</p>
        <pre>from plotdevice.lib.geometry import angle, distance, coordinates, reflect</pre>

      <p>Or, more conveniently, you can use methods of the same names provided by the <a href="../ref/Misc.html#Point">Point</a> and <a href="../ref/Drawing.html#Curve">Curve</a> classes. For example:</p>

      <table border="0">
        <tbody>
          <tr>
            <td><img alt="math-angle" height="260" src="../etc/tut/math-angle.jpg" width="260"/>
            </td><td>
              <p>The direction from the center of random points.</p>
<pre>
r = 2.0
origin = Point(WIDTH/2, HEIGHT/2)

for i in range(5):
    pt = Point(random(WIDTH),
               random(HEIGHT))
    arc(pt.x, pt.y, r)
    a = origin.angle(pt)
    with transform(CORNER):
        translate(origin.x, origin.y)
        rotate(-a)
        arrow(30, 0, 10)
</pre>
          </td></tr><tr>
            <td><img alt="math-coordinates" height="260" src="../etc/tut/math-coordinates.jpg" width="260"/>
            </td><td>
              <p>Orbiting around an origin point.</p>
<pre>
r = 2.0
origin = Point(WIDTH/2, HEIGHT/2)
oval(origin.x-r, origin.y-r, r*2, r*2)

for i in range(10):
    a = 36*i
    pt = origin.coordinates(85, a)
    arc(pt.x, pt.y, r)
    line(origin.x, origin.y, pt.x, pt.y)
</pre>
          </td></tr><tr>
            <td><img alt="math-perpendicular" height="260" src="../etc/tut/math-perpendicular.jpg" width="260"/>
            </td><td>
              <p>Perpendicular lines on a circle path.</p>
<pre>
path = oval(100, 100, 105, 105)
for t in range(50):
    curve = path.point(t/50.0)
    a = curve.angle(curve.ctrl2)
    with transform(CORNER):
        translate(curve.x, curve.y)
        rotate(-a+90) # rotate by 90°
        line(0, 0, 35, 0)
</pre>
            </td></tr></tbody></table>
    <h2>Angle measurements</h2>
    <p>As you may remember from trigonometry, there are two commonly used systems for expressing the size of angles. In day-to-day life we're most likey to encounter ‘degrees’ ranging from 0 to 360. In mathematics it's more traditional to use ‘radians’ ranging from 0 to 2&pi;. PlotDevice recognizes that different situations may call for different angle units and provides some utilities to make switching between them easy.</p>

    <p>A number of commands take an angle as one of the arguments. By default, you're expected to use degrees. But by calling the <a href="geometry()">geometry()</a> command with <code class="kw">DEGREES</code>, <code class="kw">RADIANS</code>, or <code class="kw">PERCENT</code> you can switch between modes on the fly.</p>

    <p>Any subsequent call to a drawing or transformation command that deals with angles will then deal in the newly-specified units. The <i>angle()</i> and <i>coordinates()</i> methods discussed above also obey the <i>geometry()</i> setting – both for interpreting arguments and providing return values.</p>

    <table>
      <td><img src="../etc/tut/math-angles.png"></img></td>
      <td>    <pre>
with stroke(0), nofill():
    arc(50,25, 25, range=180)

    geometry(RADIANS)
    arc(50,50, 25, range=pi)

    geometry(PERCENT)
    arc(50,75, 25, range=.5)</pre>
</td>
    </table>
    <p>To make working with radians more convenient, PlotDevice provides a pair of global constants – <code class="kw">pi</code> and <code class="kw">tau</code> – representing a half- and full-circle respectively.
      </p>

    </div><a id="Sequences" name="Sequences"></a>

    <div class="section">
      <h3>Sequences</h3>

      <p>Sometimes you want to give a position and/or size to objects in such a way that they
      interrelate to each other, that there is some kind of ordering or harmony between them. Sine
      waves for example are great to describe motion because they ease in and out. Another
      interesting proportional principle is the <i>golden ratio</i>, the 3-5-8 rule. It has been
      around in aesthetics for a long long time. The great thing about it is that it can be
      expressed as a mathematical series (Fibonacci sequence).</p>
<pre>def fib(n):
    if n == 0: return 0
    if n == 1: return 1
    if n &gt;= 2: return fib(n-1) + fib(n-2)

def goldenratio(n, f=4):
    # Returns two proportional numbers whose sum is n.
    f = max(1, min(f, 10))
    n /= float(fib(f+2))
    return n*fib(f+1), n*fib(f)
</pre> 

      <p>Colored rectangles proportioned with the golden ratio:</p>
      <table border="0">
        <tbody>
          <tr>
            <td><img alt="math-fib1" height="260" src="../etc/tut/math-fib1.jpg" width="260"/>
            </td><td>
<pre>
w1, w2 = goldenratio(260)
h1, h2 = goldenratio(260)
b1, b2 = goldenratio(1.0)
b3, b4 = goldenratio(b1)

fill(0, b1/2, b1)
rect(0, 0, w1, h1)

fill(0, b2/2, b2)
rect(w1, 0, w2, h1)

fill(0, b4/2, b4)
rect(0, h1, w1+w2, h2)
</pre>
          </td></tr><tr>
            <td><img alt="math-fib2" height="260" src="../etc/tut/math-fib2.jpg" width="260"/>
            </td><td>
<pre>
x, y = 0, 0
w, h = 260, 260

th = h # top height
bh = 0 # bottom height
for i in range(10):
    th, bh = goldenratio(th)
    v = float(th)/w + 0.3
    fill(0, v/2, v)
    rect(x, y, w, th)
    y += th
    th = bh
</pre>
            </td></tr></tbody></table>

      <p> </p>
    </div><a id="Trigonometry" name="Trigonometry"></a>

    <div class="section">
      <h3>Trigonometry</h3>

      <p><span class="big_text">A sine calculates the vertical offset between two points based on
      the angle. A cosine calculates the horizontal distance.</span></p>
      <p> </p>
      <table border="0">
        <tbody>
          <tr>
            <td><img alt="math-trig1" height="260" src="../etc/tut/math-trig1.jpg" width="260"/>
            </td><td>
              <p>Let’s say we have two points, <em>a</em> and <em>b</em>, connected by a line.</p>
          </td></tr><tr>
            <td><img alt="math-trig2" height="260" src="../etc/tut/math-trig2.jpg" width="260"/>
            </td><td>
              <p>Now let’s assume <em>a</em> is at the origin (or center) of a circle. The circle
              has a radius equal to the length of the line connecting <em>a</em> and <em>b</em>.</p>
              <p>So <em>b</em> is located somewhere on the circle’s circumference.</p>
          </td></tr><tr>
            <td><img alt="math-trig3" height="260" src="../etc/tut/math-trig3.jpg" width="260"/>
            </td><td>
              <p>There is a horizontal and vertical distance between <em>a</em> and <em>b</em>.</p>
              <p>We can use <em>sine</em> and <em>cosine</em> to determine those distances.</p>
          </td></tr><tr>
            <td><img alt="math-trig4" height="260" src="../etc/tut/math-trig4.jpg" width="260"/>
            </td><td>
              <p>Each line from <em>a</em> to a point on the circle’s circumference (for example,
              <em>b</em>) has an angle.</p>
              <p>Measured counterclockwise, starting from 0°, a circle has a total circumference of
              360°. So a line from <em>a</em> going straight up would have an angle of 90°.</p>
              <p>In the case of the line between <em>a</em> and <em>b</em>, the angle is 60°.</p>
          </td></tr><tr>
            <td><img alt="math-trig5" height="260" src="../etc/tut/math-trig5.jpg" width="260"/>
            </td><td>
              <p>The cosine function calculates the <strong>horizontal</strong> distance between
              <em>a</em> and <em>b</em> based on the angle.</p>
              <p>The sine function calculates the <strong>vertical</strong> distance between
              <em>a</em> and <em>b</em>.</p>
              <p>In the case of an angle of 60°, the sine yields 0.5. So the horizontal distance
              between <em>a</em> and <em>b</em> is half the length of the line between <em>a</em>
              and <em>b</em>.</p>
          </td></tr><tr>
            <td><img alt="math-trig6" height="260" src="../etc/tut/math-trig6.jpg" width="260"/>
            </td><td>
              <p>With sine and cosine we can calculate the distance between <em>a</em> and
              <em>b</em>.</p>
              <p>This is useful if we have position coordinates for <em>a</em> and we need to
              calculate the position of a point <em>b</em> that is orbiting around it.</p>
              <p>For 60°, the sine yields 0.5, meaning half the length of the distance between
              <em>a</em> and <em>b</em>. So the horizontal distance between <em>a</em> and
              <em>b</em> is 70 * 0.5 = 35.</p>
              <p>So <em>b</em>’s x equals <em>a</em>’s x plus 35.<br/></p>
          </td></tr><tr>
            <td><img alt="math-trig7" height="260" src="../etc/tut/math-trig7.jpg" width="260"/>
            </td><td>
              <p>The command in PlotDevice would look like this:</p>
<pre>
def coordinates(x0, y0, distance, angle):
    from math import radians, sin, cos
    angle = radians(angle)
    x1 = x0 + cos(angle) * distance
    y1 = y0 + sin(angle) * distance
    return x1, y1
</pre> 
            </td></tr></tbody></table>
    </div>
  </div>

</body></html>