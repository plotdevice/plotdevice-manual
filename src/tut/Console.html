<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html><head>

  <title></title>

</head><body>
  <div class="article">
    <h1>Using PlotDevice in another application</h1>

    <p>The PlotDevice core is now split off from the UI functionality, so you can use it in any
    project. There are a few different ways of using PlotDevice.</p>
    <h2>1. The easy way: from PlotDevice itself</h2>

    <p>One of the new features in PlotDevice is that you can access the canvas object. It’s a
    list-like structure, containing all your graphical objects (’grobs’). The canvas also has a
    ‘save’ method, so anywhere in your script you can do:</p>
<pre>canvas.save("partial.pdf")
</pre>

    <p>And it will save what it has drawn <em>up until that point.</em> Do it at the end of your
    script, and you get the full output.</p>
    <p>After saving, you might want to clear out the canvas. You can:</p>
<pre>canvas.clear()
</pre>

    <p>This will remove all grobs already on the canvas; they will not show up in the render.</p>
    <h2>2. Installing the PlotDevice module</h2>

    <p>If you want to use PlotDevice from the command line, you will have to install it. We currently
    recommend using <a href="http://subversion.tigris.org/" title="Subversion">Subversion</a> to
    grab a copy:</p>
<pre>svn co http://dev.nodebox.net/svn/plotdevice/trunk/ plotdevice
cd libs/Numeric
python setup.py install
cd ../..
 
cd libs/pathmatics
python setup.py install
cd ../..
 
cd libs/polymagic
python setup.py install
cd ../..
 
cd src
python setup.py install
</pre>

    <p>The only outside dependency is <a href="http://pyobjc.sourceforge.net/" title="PyObjC">PyObjC</a>. We recommend the latest version from Subversion.</p>
    <h2>3. Using the console runner</h2>

    <p>When you have a set of PlotDevice scripts that you want to run to generate images or a movie,
    use the following commands:</p>
<pre>from plotdevice import console
source = "size(200,200)\nrect(random(WIDTH), random(HEIGHT), 20, 20)"
console.make_image(source, "rect.png")
console.make_movie(source, "rect.mov", 20, fps=30)
</pre>

    <p>Currently, there is no way to run the console from the command line, but we’re working on
    that.</p>
    <h2>4. Accessing the context directly</h2>

    <p>If you want to have direct access to PlotDevice’s drawing context, you can import everything
    directly. The API remains the same, but you have to prefix everything with the context. Note
    also the initialization of Cocoa, necessary for using the API.</p>
<pre>from AppKit import NSApplication
NSApplication.sharedApplication().activateIgnoringOtherApps_(0)
 
from plotdevice.graphics import Context
from plotdevice.util import random, choice, grid, files
ctx = Context()
ctx.size(200, 200)
ctx.rect(random(ctx.WIDTH), random(ctx.HEIGHT), 100, 100)
ctx.save("test.png")
</pre>

    <p>You can also make movies this way:</p>
<pre>from AppKit import NSApplication
NSApplication.sharedApplication().activateIgnoringOtherApps_(0)
 
from plotdevice.graphics import Context
from plotdevice.util import random, choice, grid, files
from plotdevice.util.QTSupport import Movie
 
movie = Movie("rects.mov")
for i in range(10):
   ctx = Context()
    ctx.size(200, 200)
 ctx.rect(random(ctx.WIDTH), random(ctx.HEIGHT), 100, 100)
  movie.add(ctx)
movie.save()
</pre>

    <h2>5. Drawing in a Cocoa drawRect method</h2>

    <p>If you want to implement your existing drawing using PlotDevice, you can do the following in
    your class’s drawRect: method:</p>
<pre>def drawRect_(self, rect):
    from plotdevice.graphics import Context
   from plotdevice.util import random
    ctx.size(*rect[1])
 ctx.rect(random(ctx.WIDTH), random(ctx.HEIGHT), 100, 100)
  ctx.canvas.draw()
</pre>

    <p>Note that creating the Context and drawing it are two separate steps:</p>
    <ul>
      <li>First, the context is created; all drawing commands are translated into graphic objects
      (’grobs’) that are stored on the canvas.
      </li><li>Then, the canvas is drawn; each grob now renders itself on the current Cocoa graphics
      context.
    </li></ul>

    <p>This also means you can cache the context (or the canvas) and use it in a drawRect method
    during a later stage.</p>
  </div>

</body></html>